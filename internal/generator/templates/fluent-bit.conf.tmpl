# Fluent Bit configuration for {{.Name}} development environment
# Generated by dockstart - https://github.com/jpequegn/dockstart
#
# This configuration collects logs from the Docker logging driver
# and outputs them to stdout for easy viewing during development.

[SERVICE]
    # Flush logs every 1 second
    Flush           1
    # Log level for Fluent Bit itself
    Log_Level       info
    # Don't exit on error
    Daemon          off
    # Parse configuration files
    Parsers_File    /fluent-bit/etc/parsers.conf

# Input: Receive logs from Docker containers via forward protocol
[INPUT]
    Name            forward
    Listen          0.0.0.0
    Port            24224
    Tag             docker.*

{{- if eq .LogFormat "json"}}
# Filter: Parse JSON logs from application
[FILTER]
    Name            parser
    Match           docker.*
    Key_Name        log
    Parser          json
    Reserve_Data    On
{{- end}}

# Filter: Add metadata to logs
[FILTER]
    Name            modify
    Match           *
    Add             environment development
    Add             project {{.Name}}

# Output: Print to stdout for development visibility
[OUTPUT]
    Name            stdout
    Match           *
    Format          json_lines

{{- if .EnableFileOutput}}
# Output: Write logs to file for persistence
[OUTPUT]
    Name            file
    Match           *
    Path            /var/log/fluentbit
    File            {{.Name}}.log
{{- end}}
